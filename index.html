<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mr.Web!</title>
    <style>
        body {
            background-color: SeaGreen;
        }

        .page-title {
            color: yellow;
            text-align: center;
            font-size: 48px;
            font-family: Arial, sans-serif;
            font-weight: normal;
            font-style: normal;
            text-decoration: none;
        }

        .header-text {
            color: red;
            text-align: center;
            font-size: 20px;
            font-family: Verdana, sans-serif;
            font-weight: normal;
            font-style: normal;
            text-decoration: none;
        }

        .subheader-text {
            color: blue;
            text-align: center;
            font-size: 36px;
            font-family: Georgia, serif;
            font-weight: normal;
            font-style: normal;
            text-decoration: none;
        }

        .minorheader-text {
            color: green;
            font-size: 16px;
            font-family: "Times New Roman", serif;
            font-weight: normal;
            font-style: normal;
            text-decoration: none;
            text-align: center;
        }

        .additional-header-text {
            color: yellow;
            text-align: left;
            font-size: 24px;
            font-family: Arial, sans-serif;
            font-weight: normal;
            font-style: normal;
            text-decoration: none;
        }

        a {
            color: black;
            font-size: 14px;
            font-family: Helvetica, sans-serif;
        }

        a:visited {
            color: aquamarine;
        }

        .link-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
            padding: 0;  /* Asegurarse de que no hay padding */
        }

        .link-container a {
            line-height: 1.2;
        }

        .top-link {
            color: orange;
            text-align: center;
            font-size: 16px;
            font-family: Arial, sans-serif;
            font-weight: bold;
            font-style: italic;
            text-decoration: none;
            margin-top: 10px;
        }

        .top-link:visited {
            color: darkorange;
        }

        .button1 {
            background-color: #4CAF50;
            color: white;
            width: 200px;
            height: 50px;
            padding: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            font-family: Tahoma, sans-serif;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 4px;
            border: 2px solid #4CAF50;
            box-sizing: border-box;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        /* Asegurarse de que no hay margen superior no deseado en el contenedor principal */
        #content {
            margin-top: 0;
        }

        /* Estilos personalizados para el índice */
        .index-link {
            font-family: Arial, sans-serif;
            font-size: 14px;
            color: black;
            text-decoration: none;
            display: block;
            margin-bottom: 5px;
        }

        .index-link:hover {
            color: blue;
            text-decoration: underline;
        }

        /* Estilo para mostrar texto en mayúsculas */
        .uppercase-text {
            text-transform: uppercase;
        }
    </style>
</head>
<body>
    <h1 class="page-title" id="h1">Mr.Web!</h1>
    <h2 class="header-text" id="h2">Encabezado del Contenido</h2>

    <div class="button-container">
        <button class="button1" id="selectFileButton">Seleccionar Archivo</button>
        <input type="file" id="fileInput" accept=".txt" style="display:none;">
    </div>

    <div id="content">
        <h3 class="subheader-text" id="h3">#######</h3>
        <h4 class="minorheader-text" id="h4">[0]</h4>
        <h5 class="additional-header-text" id="h5"></h5>
    </div>

<script>
    let showHeaders = { h1: 'yes', h2: 'none', h3: 'yes', h4: 'none', h5: 'yes' };
    let showNumbering = 'none';

    let selectedFile = null;

    function updateVisibility() {
        for (let tag in showHeaders) {
            document.querySelectorAll(tag).forEach(el => {
                el.style.display = showHeaders[tag] === 'yes' ? '' : 'none';
            });
        }
    }

    function toggleUppercase(elementId, shouldEnable) {
        const element = document.getElementById(elementId);
        if (shouldEnable) {
            element.classList.add('uppercase-text');
        } else {
            element.classList.remove('uppercase-text');
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateVisibility();
        toggleUppercase('h1', true); // Activa mayúsculas en H1
        toggleUppercase('h2', true); // Activa mayúsculas en H2
        toggleUppercase('h3', true); // Activa mayúsculas en H3
        toggleUppercase('h4', true); // Activa mayúsculas en H4
        toggleUppercase('h5', true); // Activa mayúsculas en H5
        toggleUppercase('selectFileButton', true); // Activa mayúsculas en el botón de selección de archivo
    });

    document.getElementById('selectFileButton').addEventListener('click', function() {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function() {
        const fileInput = document.getElementById('fileInput');
        selectedFile = fileInput.files[0];

        let fileName = selectedFile.name;
        fileName = fileName.substring(0, fileName.lastIndexOf('.')) || fileName;
        document.getElementById('h3').textContent = fileName;

        document.querySelectorAll('.link-container').forEach(link => link.remove());

       if (selectedFile) {
            const reader = new FileReader();

            reader.onload = function(e) {
                const content = e.target.result;
                const linkRegex = /(?:https?|ftp):\/\/[\n\S]+/g;
                const links = content.match(linkRegex);

                if (links) {
                    // Ordenar los enlaces teniendo en cuenta solo el texto después de "www."
                    links.sort((a, b) => {
                        const aDomain = (new URL(a)).hostname.replace(/^www\./, '');
                        const bDomain = (new URL(b)).hostname.replace(/^www\./, '');
                        return aDomain.localeCompare(bDomain);
                    });

                    const linksHTML = links.map((url, index) => {
                        const urlWithoutProtocol = url.replace(/https?:\/\/(www\.)?/, '');
                        const shortUrl = urlWithoutProtocol.split('/')[0]; // Solo la primera barra
                        return `
                        <div class="link-container" id="${shortUrl.replace(/[^\w]/g, '_')}" style="margin-top: 10px;">
                            ${showNumbering === 'yes' ? `<span class="link-number">${index + 1}.</span>` : ''}
                            <a class="break-all" href="${url}" target="_blank">${url}</a>
                        </div>`;
                    }).join('');

                    document.getElementById('content').innerHTML += linksHTML;

                    // Actualiza el h4 con la cantidad de enlaces en formato [número]
                    document.getElementById('h4').textContent = `[${links.length}]`;

                    // Genera el índice de enlaces
                    const baseUrls = links.reduce((acc, link) => {
                        const url = new URL(link);
                        const baseUrl = url.hostname.replace(/^www\./, '').toLowerCase();
                        acc[baseUrl] = acc[baseUrl] || [];
                        acc[baseUrl].push(url.href);
                        return acc;
                    }, {});

                    const indexHTML = Object.keys(baseUrls)
                        .sort()
                        .map(baseUrl => {
                            const shortBaseUrl = baseUrl.replace(/[^\w]/g, '_');
                            return `<a href="#${shortBaseUrl}" class="index-link">${baseUrl} [${baseUrls[baseUrl].length}]</a>`;
                        })
                        .join('');

                    document.getElementById('h5').innerHTML = `Índice [${links.length}]<div style="margin-top: 5px; margin-bottom: 0;"></div>${indexHTML}<div style="margin-bottom: 10px;"></div>`;

                    const linkContainers = document.querySelectorAll('.link-container');
                    linkContainers.forEach((container, i) => {
                        if ((i + 1) % 20 === 0) {
                            const topLink = document.createElement('a');
                            topLink.href = '#';
                            topLink.className = 'top-link'; // Clase básica para el enlace

                            let shouldEnableUppercase = true; // Cambia a false para desactivar las mayúsculas
                            if (shouldEnableUppercase) {
                                topLink.classList.add('uppercase-text'); // Activa mayúsculas en el enlace "Volver al principio"
                            }

                            topLink.innerHTML = '&#8593; Volver al principio';
                            container.insertAdjacentHTML('afterend', '<div style="margin-bottom: 10px;"></div>' + topLink.outerHTML + '<div style="margin-top: 10px;"></div>');
                        }
                    });

                    updateVisibility(); // Actualizar visibilidad de encabezados

                    // Aplicar estilos de mayúsculas directamente desde el código
                    toggleUppercase('h1', true); // Mayúsculas en H1
                    toggleUppercase('h2', true); // Mayúsculas en H2
                    toggleUppercase('h3', true); // Mayúsculas en H3
                    toggleUppercase('h4', true); // Mayúsculas en H4
                    toggleUppercase('h5', true); // Mayúsculas en H5
                    toggleUppercase('selectFileButton', true); // Mayúsculas en el botón de selección de archivo

                    // Controlar mayúsculas en el índice
                    toggleUppercase('h5', true); // Cambia a false para desactivar las mayúsculas en el índice

                    // Controlar mayúsculas en los enlaces del índice
                    const linkElements = document.querySelectorAll('.index-link');
                    linkElements.forEach(link => {
                        link.classList.add('uppercase-text'); // Aplicar directamente la clase
                    });
                }
            };

            reader.readAsText(selectedFile);
        }
    });

    document.getElementById('fileInput').addEventListener('click', function() {
        this.value = null;
    });

    function setVisibility(tag, visibility) {
        if (tag === 'numbering') {
            showNumbering = visibility;
        } else {
            showHeaders[tag] = visibility;
        }
        updateVisibility();
    }
</script>
</body>
</html>

