<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyect TES:Legends</title>
    <style>
        body {
            margin: 0; /* Eliminar cualquier margen del body */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh; /* Asegurar que el body ocupe toda la altura de la ventana */
            padding: 0;
        }
        .title {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin: 5px 0; /* Reducir el margen del título */
        }
        .container {
            position: relative;
            width: calc(100% - 20px); /* Ajustar el ancho para espacio a los lados */
            height: calc(100vh - 150px); /* Ajustar la altura considerando el espacio del título y los botones */
            margin: 0; /* Quitar el margen alrededor del contenedor */
            padding: 5px; /* Reducir el padding alrededor del contenedor */
            box-sizing: border-box;
            overflow: hidden;
        }
        .main-image, .layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Mantiene el ratio de proporción de la imagen */
        }
        .layer {
            display: none;
        }
        #layer0 {
            z-index: 0; /* Nueva capa 0 */
        }
        #layer1 {
            z-index: 1; /* Nueva capa antes de la capa 1 */
        }
        #layer2 {
            z-index: 2; /* Capa más atrás */
        }
        #layer3 {
            z-index: 3; /* Capa intermedia */
        }
        #layer4 {
            z-index: 4; /* Capa más adelante */
        }
        #layer5 {
            z-index: 5; /* Nueva capa más adelante */
        }
        #layer6 {
            z-index: 6; /* Nueva capa más adelante */
        }
        #layer7 {
            z-index: 7; /* Nueva capa más adelante */
        }
        #layer8 {
            z-index: 8; /* Nueva capa más adelante */
        }
        .controls {
            margin: 5px 0; /* Reducir el margen entre los controles y otros elementos */
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .controls > div {
            margin: 2px 0; /* Añadir separación entre botones */
        }
        .save-button {
            margin-top: 10px;
            padding: 5px 10px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1 class="title">Project TES: Legends</h1>
    <div class="container" id="image-container">
        <img class="main-image" id="main-image" src="Images/Main.png" alt="Imagen Principal">
        <img id="layer0" class="layer" alt="C0">
        <img id="layer1" class="layer" alt="C1">
        <img id="layer2" class="layer" alt="C2">
        <img id="layer3" class="layer" alt="C3">
        <img id="layer4" class="layer" alt="C4">
        <img id="layer5" class="layer" alt="C5">
        <img id="layer6" class="layer" alt="C6">
        <img id="layer7" class="layer" alt="C7">
        <img id="layer8" class="layer" alt="C8">
    </div>
    <div class="controls">
        <div>
            <label for="layer0-select">Capa 0:</label>
            <select id="layer0-select" onchange="changeLayer('layer0', this.value, 'group0')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun0.jpg">Común</option>
                <option value="Images/rara0.jpg">Rara</option>
                <option value="Images/epica0.jpg">Épica</option>
                <option value="Images/legendaria0.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer1-select">Capa 1:</label>
            <select id="layer1-select" onchange="changeLayer('layer1', this.value, 'group1')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun1.jpg">Común</option>
                <option value="Images/rara1.jpg">Rara</option>
                <option value="Images/epica1.jpg">Épica</option>
                <option value="Images/LG-card-Blood_Dragon.png">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer2-select">Capa 2:</label>
            <select id="layer2-select" onchange="changeLayer('layer2', this.value, 'group2')">
                <option value="">Seleccionar...</option>
                <option value="Images/Magika_6.png">6</option>
                <option value="Images/rara2.jpg">Rara</option>
                <option value="Images/epica2.jpg">Épica</option>
                <option value="Images/legendaria2.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer3-select">Rareza:</label>
            <select id="layer3-select" onchange="changeLayer('layer3', this.value, 'group3')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun3.jpg">Común</option>
                <option value="Images/rara3.jpg">Rara</option>
                <option value="Images/epica3.jpg">Épica</option>
                <option value="Images/legendaria3.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer4-select">Mana:</label>
            <select id="layer4-select" onchange="changeLayer('layer4', this.value, 'group4')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun4.jpg">Común</option>
                <option value="Images/rara4.jpg">Rara</option>
                <option value="Images/epica4.jpg">Épica</option>
                <option value="Images/legendaria4.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer5-select">Capa 3:</label>
            <select id="layer5-select" onchange="changeLayer('layer5', this.value, 'group5')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun5.jpg">Común</option>
                <option value="Images/rara5.jpg">Rara</option>
                <option value="Images/epica5.jpg">Épica</option>
                <option value="Images/legendaria5.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer6-select">Capa 4:</label>
            <select id="layer6-select" onchange="changeLayer('layer6', this.value, 'group6')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun6.jpg">Común</option>
                <option value="Images/rara6.jpg">Rara</option>
                <option value="Images/epica6.jpg">Épica</option>
                <option value="Images/legendaria6.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer7-select">Capa 5:</label>
            <select id="layer7-select" onchange="changeLayer('layer7', this.value, 'group7')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun7.jpg">Común</option>
                <option value="Images/rara7.jpg">Rara</option>
                <option value="Images/epica7.jpg">Épica</option>
                <option value="Images/legendaria7.jpg">Legendaria</option>
            </select>
        </div>
        <div>
            <label for="layer8-select">Capa 6:</label>
            <select id="layer8-select" onchange="changeLayer('layer8', this.value, 'group8')">
                <option value="">Seleccionar...</option>
                <option value="Images/comun8.jpg">Común</option>
                <option value="Images/rara8.jpg">Rara</option>
                <option value="Images/epica8.jpg">Épica</option>
                <option value="Images/legendaria8.jpg">Legendaria</option>
            </select>
        </div>
    </div>
    <input type="file" id="file-input" class="save-button" onchange="loadLayerImage(event)">
    <button class="save-button" onclick="saveImage()">Guardar Imagen</button>

    <script>
        function changeLayer(layerId, src, groupId) {
            // Ocultar todas las capas del mismo grupo
            var layers = document.querySelectorAll(`[data-group='${groupId}']`);
            layers.forEach(function(layer) {
                layer.style.display = 'none';
            });

            // Ocultar la imagen principal
            document.getElementById('main-image').style.display = 'none';

            // Mostrar la nueva capa seleccionada
            var layer = document.getElementById(layerId);
            if (src !== "") {
                layer.src = src;
                layer.style.display = "block";
                layer.setAttribute('data-group', groupId); // Añadir atributo de grupo a la nueva capa seleccionada
            }
        }

        function loadLayerImage(event) {
            var file = event.target.files[0];
            var reader = new FileReader();
            reader.onload = function(e) {
                var img = document.getElementById('layer0');
                img.src = e.target.result;
                img.style.display = 'block';
                img.setAttribute('data-group', 'group0'); // Asignar el grupo a la nueva capa
            };
            reader.readAsDataURL(file);
        }

        function saveImage() {
            var container = document.getElementById('image-container');
            var canvas = document.createElement('canvas');
            canvas.width = 1400;
            canvas.height = 2000;
            var ctx = canvas.getContext('2d');

            var images = container.querySelectorAll('img');
            images.forEach(function(img) {
                if (img.style.display !== 'none') {
                    var imgAspectRatio = img.naturalWidth / img.naturalHeight;
                    var canvasAspectRatio = canvas.width / canvas.height;
                    if (imgAspectRatio > canvasAspectRatio) {
                        var height = canvas.width / imgAspectRatio;
                        ctx.drawImage(img, 0, (canvas.height - height) / 2, canvas.width, height);
                    } else {
                        var width = canvas.height * imgAspectRatio;
                        ctx.drawImage(img, (canvas.width - width) / 2, 0, width, canvas.height);
                    }
                }
            });

            var link = document.createElement('a');
            link.download = 'TES_Legends.png';
            link.href = canvas.toDataURL('image/png');
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
    </script>

    <!-- Incluir la librería html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>
